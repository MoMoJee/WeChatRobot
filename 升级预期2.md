# 升级预期

## 1. ui

ui在启动时、挂起时启动：

1. AI的网址、模型名称、对应的API及其备注名。用json记录。详情见下

1. 监听对象

2. 选择历史记录

3. 选择人格文件

只有1能够在运行中修改！



### 1.2 UI函数Setting的实现方式：

函数会直接在Main中调用，后三个很简单，而对于第一个：直接修改全局变量吧。。我懒改完之后调用AIConnect

注意，原有的read_api_key弃之不用，api直接用全局变量获得




### 1.3 针对read_api_key的修改

之后直接读取这个：

```json
[
  {
    "url": "https://api.deepseek.com",
    "model": "deepseek-chat",
    "api": "我的api",
    "api_name": "WeChatRobot_deepseek-chat",
    "code": 1
  },
  {
    "url": "https://api.moonshot.cn/v1",
    "model": "moonshot-v1-8k",
    "api": "我的api",
    "api_name": "WeChatRobot_moonshot-v1-8kt",
    "code": 2
  }
]
```

然后把选中的这一组写进全局变量。为了减少代码修改，就直接写五个全局变量吧，写一个的话还都得改一堆
说不定我明天又想改了





## 2. 给AI的聊天记录格式

1. 时间

2. 人名

3. 信息



## 3. 针对撤回消息的处理

1. 首先获取信息时，改成获取群里备注名。因为系统和获取撤回只显示群里名字
2. 检测到xxx撤回一条消息时，在历史记录G_conversation_history中找到最近的这个人发的消息，删除之
3. 只支持最近一条消息撤回。（应该如何判断撤回的是发给机器人的还是发给其他人的呢？ 我知道了。监听时，如果这个人的消息最近一次收到监听没有包含关键词，就标记为无法执行撤回回滚操作。但这样需要创建一个包含所有人名的列表，写不动了

## 4. 继续写Suspend状态下的设置界面

1. 获取群成员，增设选定黑名单等等功能

## 5. 优化控制台方式

1. 集成@@退出指令到控制台
2. 通过某种验证逻辑，使得控制台指令可以在前台发出。同时不让AI的输出被识别为cc指令

## 6. 流式输出